/****************************************************************************/
/*	Description		:WATCHDOG監視プロセスI/F関数ソースコード					*/
/*--------------------------------------------------------------------------*/
/*	Author			:DHC Chen.H											*/
/*--------------------------------------------------------------------------*/
/*	Date			:2023/03/28												*/
/*--------------------------------------------------------------------------*/
/*	Module Name		:WDT													*/
/*--------------------------------------------------------------------------*/
/*	Note			:														*/
/*--------------------------------------------------------------------------*/
/*	Copyright		:(c) 2020 NICHICON CORPORATION							*/
/****************************************************************************/

/*--------------------------------------------------------------------------*/
/*	Include Header File														*/
/*--------------------------------------------------------------------------*/
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "task_g.h"
#include "dlog_g.h"
#include "wdt_g.h"

/*--------------------------------------------------------------------------*/
/*	公開変数定義															*/
/*--------------------------------------------------------------------------*/


/*--------------------------------------------------------------------------*/
/*	非公開変数定義															*/
/*--------------------------------------------------------------------------*/


/*--------------------------------------------------------------------------*/
/*	公開関数定義															*/
/*--------------------------------------------------------------------------*/
/*==========================================================================*/
/*	Description		:WATCHDOG応答通知										*/
/*--------------------------------------------------------------------------*/
/*	param			:uchar	timeout	タイムアウト値(秒)						*/
/*--------------------------------------------------------------------------*/
/*	return			:0	正常終了	-1	異常終了							*/
/*--------------------------------------------------------------------------*/
/*	detail			:														*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/28 : DHC Chen.H : 新規作成					*/
/*==========================================================================*/
slong WDT_AsyncSendWdtRes(uchar timeout)
{
	slong ret = WDT_OK;
	WdtFncWdtRes_t msg;
	uchar timeoutVal = 0;
	DEBUG_TRCIN();

	timeoutVal = WDT_PROC_TIMEOUT_DEF;

	/* メッセージ生成 */
	memset(&msg, 0x00, sizeof(msg));

	/* 非同期メッセージ送信 */
	msg.header.msgId = WDT_MSGID_WDT_RES;
	msg.timeout = timeoutVal;
	
	/* 非同期メッセージ送信 */
	ret = LFW_SendAsync(WDT_SPORT, sizeof(msg), &msg);
	if(ret != 0){
		ret = WDT_ERROR;
	}
	else
	{
		/* 処理無し */
	}
	DEBUG_TRCOUT();
	return ret;
}

/*==========================================================================*/
/*	Description		:リブート要求											*/
/*--------------------------------------------------------------------------*/
/*	param			:void													*/
/*--------------------------------------------------------------------------*/
/*	return			:0	正常終了	-1	異常終了							*/
/*--------------------------------------------------------------------------*/
/*	detail			:														*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/28 : DHC Chen.H : 新規作成					*/
/*==========================================================================*/
slong WDT_AsyncSendRebootReq(void)
{
	slong ret = WDT_OK;
	WdtFncTermReq_t msg;
	DEBUG_TRCIN();

	/* メッセージ生成 */
	memset(&msg, 0x00, sizeof(msg));
	msg.header.msgId = WDT_MSGID_TERM_REQ;
	msg.type = WDT_TERM_TYPE_REBOOT;
	
	/* 非同期メッセージ送信 */
	ret = LFW_SendAsync(WDT_SPORT, sizeof(msg), &msg);
	if(ret != 0){
		ret = WDT_ERROR;
	}
	else
	{
		/* 処理無し */
	}
	DEBUG_TRCOUT();
	return ret;
}

/*==========================================================================*/
/*	Description		:電源OFF												*/
/*--------------------------------------------------------------------------*/
/*	param			:void													*/
/*--------------------------------------------------------------------------*/
/*	return			:0	正常終了	-1	異常終了							*/
/*--------------------------------------------------------------------------*/
/*	detail			:														*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/28 : DHC Chen.H : 新規作成						*/
/*==========================================================================*/
slong WDT_AsyncSendShutdownReq(void)
{
	slong ret = WDT_OK;
	WdtFncTermReq_t msg;
	DEBUG_TRCIN();

	/* メッセージ生成 */
	memset(&msg, 0x00, sizeof(msg));
	msg.header.msgId = WDT_MSGID_TERM_REQ;
	msg.type = WDT_TERM_TYPE_SHUTDOWN;

	/* 非同期メッセージ送信 */
	ret = LFW_SendAsync(WDT_SPORT, sizeof(msg), &msg);
	if(ret != 0){
		ret = WDT_ERROR;
	}
	else
	{
		/* 処理無し */
	}
	DEBUG_TRCOUT();
	return ret;
}

/*==========================================================================*/
/*	Description		:終了応答通知											*/
/*--------------------------------------------------------------------------*/
/*	param			:WdtTermType_t	type	終了種別						*/
/*--------------------------------------------------------------------------*/
/*	return			:0	正常終了	-1	異常終了							*/
/*--------------------------------------------------------------------------*/
/*	detail			:														*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/28 : DHC Chen.H : 新規作成					*/
/*==========================================================================*/
slong WDT_AsyncSendTermRes(WdtTermType_t type)
{
	slong ret = WDT_OK;
	WdtFncTermRes_t msg;
	DEBUG_TRCIN();
	/* パラメータチェック */
	if ((type != WDT_TERM_TYPE_REBOOT) && 
		(type != WDT_TERM_TYPE_SHUTDOWN))
	{
		DEBUG_TRCOUT();
		return WDT_ERROR;
	}
	else
	{
		/* メッセージ生成 */
		memset(&msg, 0x00, sizeof(msg));
		msg.header.msgId = WDT_MSGID_TERM_RES;
		msg.type = type;
		
		/* 非同期メッセージ送信 */
		ret = LFW_SendAsync(WDT_SPORT, sizeof(msg), &msg);
		if(ret != 0){
			ret = WDT_ERROR;
		}
		else
		{
			/* 処理無し */
		}
	}

	DEBUG_TRCOUT();
	return ret;
}

/*--------------------------------------------------------------------------*/
/*	非公開関数定義															*/
/*--------------------------------------------------------------------------*/

/*End Of File*/
