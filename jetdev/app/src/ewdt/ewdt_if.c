/****************************************************************************/
/*	Description		:WATCHDOG監視プロセスI/F関数ソースコード					*/
/*--------------------------------------------------------------------------*/
/*	Author			:DHC Chen.H											*/
/*--------------------------------------------------------------------------*/
/*	Date			:2023/03/28												*/
/*--------------------------------------------------------------------------*/
/*	Module Name		:EWDT													*/
/*--------------------------------------------------------------------------*/
/*	Note			:														*/
/*--------------------------------------------------------------------------*/
/*	Copyright		:(c) 2020 NICHICON CORPORATION							*/
/****************************************************************************/

/*--------------------------------------------------------------------------*/
/*	Include Header File														*/
/*--------------------------------------------------------------------------*/
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <task_g.h>
#include "ewdt.h"
#include "ewdt_local.h"

/*--------------------------------------------------------------------------*/
/*	公開変数定義															*/
/*--------------------------------------------------------------------------*/


/*--------------------------------------------------------------------------*/
/*	非公開変数定義															*/
/*--------------------------------------------------------------------------*/


/*--------------------------------------------------------------------------*/
/*	公開関数定義															*/
/*--------------------------------------------------------------------------*/
/*==========================================================================*/
/*	Description		:WATCHDOG応答通知										*/
/*--------------------------------------------------------------------------*/
/*	param			:uchar	timeout	タイムアウト値(秒)						*/
/*--------------------------------------------------------------------------*/
/*	return			:0	正常終了	-1	異常終了							*/
/*--------------------------------------------------------------------------*/
/*	detail			:														*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/28 : DHC Chen.H : 新規作成					*/
/*==========================================================================*/
slong EWDT_AsyncSendWdtRes(uchar timeout)
{
	slong ret = EWDT_OK;
	EwdtFncWdtRes_t msg;
	uchar timeoutVal = 0;
	DEBUG_TRCIN();
	timeoutVal = EWDT_PROC_TIMEOUT_DEF;

	/* メッセージ生成 */
	memset(&msg, 0x00, sizeof(msg));
	msg.Header.MsgId = EWDT_MSGID_WDT_RES;
	msg.Timeout = timeoutVal;

	/* 非同期メッセージ送信 */
	ret = FRM_MsgSendAsync(EWDT_SPORT, sizeof(msg), &msg);
	if (FRM_SUCCESS != ret)
	{
		ret = EWDT_ERROR;
	}
	else
	{
		/* 処理無し */
	}
	DEBUG_TRCOUT();
	return ret;
}

/*==========================================================================*/
/*	Description		:リブート要求											*/
/*--------------------------------------------------------------------------*/
/*	param			:void													*/
/*--------------------------------------------------------------------------*/
/*	return			:0	正常終了	-1	異常終了							*/
/*--------------------------------------------------------------------------*/
/*	detail			:														*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/28 : DHC Chen.H : 新規作成					*/
/*==========================================================================*/
slong EWDT_AsyncSendRebootReq(void)
{
	slong ret = EWDT_OK;
	EwdtFncTermReq_t msg;
	DEBUG_TRCIN();
	/* メッセージ生成 */
	memset(&msg, 0x00, sizeof(msg));
	msg.Header.MsgId = EWDT_MSGID_TERM_REQ;
	msg.Type = EWDT_TERM_TYPE_REBOOT;
	
	/* 非同期メッセージ送信 */
	ret = FRM_MsgSendAsync(EWDT_SPORT, sizeof(msg), &msg);
	if (FRM_SUCCESS != ret)
	{
		ret = EWDT_ERROR;
	}
	else
	{
		/* 処理無し */
	}
	DEBUG_TRCOUT();
	return ret;
}

/*==========================================================================*/
/*	Description		:終了応答通知											*/
/*--------------------------------------------------------------------------*/
/*	param			:EwdtTermType_t	type	終了種別						*/
/*--------------------------------------------------------------------------*/
/*	return			:0	正常終了	-1	異常終了							*/
/*--------------------------------------------------------------------------*/
/*	detail			:														*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/28 : DHC Chen.H : 新規作成					*/
/*==========================================================================*/
slong EWDT_AsyncSendTermRes(EwdtTermType_t type)
{
	slong ret = EWDT_OK;
	EwdtFncTermRes_t msg;
	DEBUG_TRCIN();
	/* パラメータチェック */
	if ((type != EWDT_TERM_TYPE_REBOOT) && 
		(type != EWDT_TERM_TYPE_SHUTDOWN))
	{
		DEBUG_TRCOUT();
		return EWDT_ERROR;
	}
	else
	{
		/* メッセージ生成 */
		memset(&msg, 0x00, sizeof(msg));
		msg.Header.MsgId = EWDT_MSGID_TERM_RES;
		msg.Type = type;
		
		/* 非同期メッセージ送信 */
		ret = FRM_MsgSendAsync(EWDT_SPORT, sizeof(msg), &msg);
		if (FRM_SUCCESS != ret)
		{
			ret = EWDT_ERROR;
		}
		else
		{
			/* 処理無し */
		}
	}

	DEBUG_TRCOUT();
	return ret;
}

/*--------------------------------------------------------------------------*/
/*	非公開関数定義															*/
/*--------------------------------------------------------------------------*/

/*End Of File*/
