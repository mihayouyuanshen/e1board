/****************************************************************************/
/*	Description		:INV通信ミドル メイン									*/
/*--------------------------------------------------------------------------*/
/*	Author			:DHC Dai.P												*/
/*--------------------------------------------------------------------------*/
/*	Date			:2023/03/23												*/
/*--------------------------------------------------------------------------*/
/*	Module Name		:INV通信												*/
/*--------------------------------------------------------------------------*/
/*	Note			:														*/
/*--------------------------------------------------------------------------*/
/*	Copyright		:(c) 2020 NICHICON CORPORATION							*/
/****************************************************************************/

/*--------------------------------------------------------------------------*/
/*	Include Header File														*/
/*--------------------------------------------------------------------------*/
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#include "typedef.h"
#include "frm_g.h"
#include "task_g.h"
#include "dlog_g.h"
#include "etim_g.h"
#include "ewdt.h"

#include "einv_msg_g.h"
#include "einv_que_g.h"
#include "einv_utl_g.h"
#include "einv_spec_g.h"
#include "einv_ram_g.h"
#include "einv_n_ram_g.h"
#include "einv_n_func_g.h"
#include "einv_com_g.h"
#include "einv_g.h"


/*--------------------------------------------------------------------------*/
/*	公開変数定義															*/
/*--------------------------------------------------------------------------*/


/*--------------------------------------------------------------------------*/
/*	非公開変数定義															*/
/*--------------------------------------------------------------------------*/


/*--------------------------------------------------------------------------*/
/*	公開関数定義															*/
/*--------------------------------------------------------------------------*/

/*==========================================================================*/
/*	Description	:INV通信ミドル 初期化処理									*/
/*--------------------------------------------------------------------------*/
/*	param		:なし														*/
/*--------------------------------------------------------------------------*/
/*	return		:なし														*/
/*--------------------------------------------------------------------------*/
/*	detail		:INV通信ミドル 初期化処理を行う。							*/
/*--------------------------------------------------------------------------*/
/*	history		：2023/03/23 : DHC Dai.P : 新規作成							*/
/*==========================================================================*/
void EINV_Init(void)
{
	DEBUG_TRCIN();

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description	:INV通信ミドル メッセージ処理								*/
/*--------------------------------------------------------------------------*/
/*	param		:msg		:メッセージ										*/
/*--------------------------------------------------------------------------*/
/*	return		:なし														*/
/*--------------------------------------------------------------------------*/
/*	detail		:INV通信ミドル メッセージ処理を行う。						*/
/*--------------------------------------------------------------------------*/
/*	history		：2023/03/23 : DHC Dai.P : 新規作成							*/
/*==========================================================================*/
void EINV_MsgProc(const FrmMsgHead_t *msg)
{
	slong ret = EINV_OK;

	DEBUG_TRCIN();

	/* メッセージ処理 */
	ret = EINV_FsmRun(msg);
	if (ret != EINV_OK)
	{
		DLOG_Error("No state management msgId occur \n");
	} 
	else
	{
		/* 処理無し */
	}

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description	:INV通信ミドル 終了処理										*/
/*--------------------------------------------------------------------------*/
/*	param		:なし														*/
/*--------------------------------------------------------------------------*/
/*	return		:なし														*/
/*--------------------------------------------------------------------------*/
/*	detail		:INV通信ミドル 終了処理を行う。								*/
/*--------------------------------------------------------------------------*/
/*	history		：2023/03/27 : DHC Dai.P : 新規作成							*/
/*==========================================================================*/
void EINV_Fin(void)
{
	DEBUG_TRCIN();

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description	:INV通信ミドル スタート処理									*/
/*--------------------------------------------------------------------------*/
/*	param		:fact		:起動要因										*/
/*--------------------------------------------------------------------------*/
/*	return		:なし														*/
/*--------------------------------------------------------------------------*/
/*	detail		:INV通信ミドル スタート処理を行う。							*/
/*--------------------------------------------------------------------------*/
/*	history		：2023/03/27 : DHC Dai.P : 新規作成							*/
/*==========================================================================*/
slong EINV_Start(ulong fact)
{
	slong ret = EINV_OK;
	slong msgRet = FRM_SUCCESS;
	EinvMsgPar_t par;

	DEBUG_TRCIN();

	/* INV状態がEINV_ST_STARTをとする */
	EINV_FsmInit(EINV_ST_START);

	/* 送信データ初期化 */
	memset(&par, 0x00, sizeof(par));

	par.initReq.header.msgId = EINV_FID_INIT;
	par.initReq.fact = fact;

	/* 非同期メッセージ送信 */
	msgRet = FRM_MsgSendAsync(EINV_SPORT, sizeof(par), (void*)&par);
	if(msgRet != FRM_SUCCESS)
	{
		DLOG_Error("FRM_MsgSendEvent fail\n");
		ret = EINV_ERR_SYSCALL;
	}
	else
	{
		/* 処理無し */
	}

	DEBUG_TRCOUT();

	return ret;
}

/*==========================================================================*/
/*	Description	:INV通信ミドル ストップ処理									*/
/*--------------------------------------------------------------------------*/
/*	param		:なし														*/
/*--------------------------------------------------------------------------*/
/*	return		:なし														*/
/*--------------------------------------------------------------------------*/
/*	detail		:PUART制御 初期化処理を行う。								*/
/*--------------------------------------------------------------------------*/
/*	history		：2023/03/27 : DHC Dai.P : 新規作成							*/
/*==========================================================================*/
slong EINV_Stop(void)
{
	slong ret = EINV_OK;
	slong msgRet = FRM_SUCCESS;
	EinvMsgPar_t par;

	DEBUG_TRCIN();

	/* INV状態がEINV_ST_TERMINALをとする */
	EINV_FsmSetState(EINV_ST_TERMINAL);

	/* 送信データ初期化 */
	memset(&par, 0x00, sizeof(par));

	par.stopReq.header.msgId = EINV_FID_STOP;

	/* 非同期メッセージ送信 */
	msgRet = FRM_MsgSendAsync(EINV_SPORT, sizeof(par), (void*)&par);
	if(msgRet != FRM_SUCCESS)
	{
		DLOG_Error("FRM_MsgSendEvent fail\n");
		ret = EINV_ERR_SYSCALL;
	}
	else
	{
		/* 処理無し */
	}

	DEBUG_TRCOUT();

	return ret;
}

/*--------------------------------------------------------------------------*/
/*	非公開関数定義															*/
/*--------------------------------------------------------------------------*/

/*End Of File*/
