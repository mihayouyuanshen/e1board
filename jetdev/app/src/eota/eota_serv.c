/****************************************************************************/
/*	Description		:FW更新機能 モジュール間処理							*/
/*--------------------------------------------------------------------------*/
/*	Author			:DHC.zhangs												*/
/*--------------------------------------------------------------------------*/
/*	Date			:2023/03/20												*/
/*--------------------------------------------------------------------------*/
/*	Module Name		:FW更新機能の機能名は、EOTAとす							*/
/*--------------------------------------------------------------------------*/
/*	Note			:														*/
/*--------------------------------------------------------------------------*/
/*	Copyright		:(c) 2023 DHC CORPORATION								*/
/****************************************************************************/

/*--------------------------------------------------------------------------*/
/*	Include Header File														*/
/*--------------------------------------------------------------------------*/
#include "eota_setting_g.h"
#include "eota_log_g.h"
#include "eota_data_g.h"

#include "eota_serv.h"

/*--------------------------------------------------------------------------*/
/* 公開変数定義																*/
/*--------------------------------------------------------------------------*/

/*--------------------------------------------------------------------------*/
/* 非公開変数定義															*/
/*--------------------------------------------------------------------------*/

/*--------------------------------------------------------------------------*/
/* 公開関数定義																*/
/*--------------------------------------------------------------------------*/

/*--------------------------------------------------------------------------*/
/* 他モジュール⇒自モジュール												*/
/*--------------------------------------------------------------------------*/
/*==========================================================================*/
/*	Description		:	FW更新処理開始										*/
/*--------------------------------------------------------------------------*/
/*	param			:	開始モード											*/
/*--------------------------------------------------------------------------*/
/*	return			:	EOTA_OK				正常終了						*/
/*						EOTA_PROCESS_ING	FW更新実施中					*/
/*--------------------------------------------------------------------------*/
/*	detail			:	FW更新処理を実施する								*/
/*						1.FW更新実施中の場合、FW更新実施中エラーを戻る		*/
/* 						2.自モジュールメッセージを送信し、FW更新を開始する	*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
schar EOTA_FWStart(EOTA_START_MODE_T fwStartMode)		/* [i] 開始モード	*/
{
	schar Ret  		 = (schar)EOTA_OK;					/* 戻り値			*/
	uchar FwRunState = EOTA_RUN_STATE_S;				/* FW 更新実施状態	*/
	EotaMsgPar_t Mssage;								/* 受信メッセージ	*/

	DEBUG_TRCIN();

	/* FW 更新実施状態取得 */
	FwRunState = EOTA_GetRunState();

	/* FW更新実施中 */
	if (EOTA_RUN_STATE_S != FwRunState)
	{
		Ret = EOTA_PROCESS_ING;
	}
	else
	{
		/* メッセージ設定 */
		Mssage.start.Header.msgId = EOTA_MSGID_START;
		Mssage.start.fwStartMode = fwStartMode;

		/* 自モジュールメッセージ送信 */
		FRM_MsgSendAsync(EOTA_SPORT, sizeof(Mssage), &Mssage);
	}

	DEBUG_TRCOUT();

	return Ret;
}

/*==========================================================================*/
/*	Description		:	ユーザ更新時点(スマホアプリから)					*/
/*--------------------------------------------------------------------------*/
/*	param			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	スマートフォンなどから更新中止信号を受信し、		*/
/*						自モジュールメッセージを送信し、					*/
/*						FW 更新停止処理を実施する							*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_FWUseTime(EOTA_UPDATE_TIME_T UpdPoint, schar * Time)
{
	EOTA_USE_UPD_T Mssage;								/* 受信メッセージ	*/

	DEBUG_TRCIN();

	/* メッセージ設定 */
	Mssage.Header.msgId = EOTA_MSGID_USE_UPD;
	Mssage.UpdPoint = UpdPoint;

	/* TODO. Time処理必要 */

	/* 自モジュールメッセージ送信 */
	FRM_MsgSendAsync(EOTA_SPORT, sizeof(Mssage), &Mssage);

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	FW更新処理中止										*/
/*--------------------------------------------------------------------------*/
/*	param			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	スマートフォンなどから更新中止信号を受信し、		*/
/*						自モジュールメッセージを送信し、					*/
/*						FW 更新停止処理を実施する							*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_FWStop()
{
	EotaMsgPar_t Mssage;									/* 受信メッセージ	*/

	DEBUG_TRCIN();

	/* メッセージ設定 */
	Mssage.stop.Header.msgId = EOTA_MSGID_STOP;

	/* 自モジュールメッセージ送信 */
	FRM_MsgSendAsync(EOTA_SPORT, sizeof(Mssage), &Mssage);

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	CMD11 受信 Data(INIから)							*/
/*--------------------------------------------------------------------------*/
/*	param			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	CMD11を受信し自モジュールメッセージを送信する		*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_DMD11Response()
{
	EotaMsgPar_t Mssage;					/* 受信メッセージ	*/

	DEBUG_TRCIN();

	/* メッセージ設定 */
	Mssage.cmd11_data.Header.msgId = EOTA_MSGID_CMD11_REQ;

	/* 自モジュールメッセージ送信 */
	FRM_MsgSendAsync(EOTA_SPORT, sizeof(Mssage), &Mssage);

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	CMD60 受信 Data(INIから)							*/
/*--------------------------------------------------------------------------*/
/*	param			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	CMD11を受信し自モジュールメッセージを送信する		*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_DMD60Response()
{
	EotaMsgPar_t Mssage;					/* 受信メッセージ	*/

	DEBUG_TRCIN();

	/* メッセージ設定 */
	Mssage.header.msgId = EOTA_MSGID_CMD60_REQ;

	/* 自モジュールメッセージ送信 */
	FRM_MsgSendAsync(EOTA_SPORT, sizeof(Mssage), &Mssage);

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	CMD64 受信 Data(INIから)							*/
/*--------------------------------------------------------------------------*/
/*	param			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	CMD64を受信し自モジュールメッセージを送信する		*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/05/06 : DHC.lib : 新規作成						*/
/*==========================================================================*/
void EOTA_DMD64Response(uchar startOrStop)
{
	EotaMsgPar_t Mssage;					/* 受信メッセージ	*/

	DEBUG_TRCIN();

	/* メッセージ設定 */
	Mssage.cmd64_data.Header.msgId = EOTA_MSGID_CMD64_REQ;
	Mssage.cmd64_data.startOrStop = startOrStop;

	/* 自モジュールメッセージ送信 */
	FRM_MsgSendAsync(EOTA_SPORT, sizeof(Mssage), &Mssage);

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	CMD65 受信 Data(INIから)							*/
/*--------------------------------------------------------------------------*/
/*	param			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	CMD65を受信し自モジュールメッセージを送信する		*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.lib : 新規作成						*/
/*==========================================================================*/
void EOTA_DMD65Response(char ret)
{
	EotaMsgPar_t Mssage;					/* 受信メッセージ	*/

	DEBUG_TRCIN();

	/* メッセージ設定 */
	Mssage.cmd65_data.Header.msgId = EOTA_MSGID_CMD65_REQ;
	Mssage.cmd65_data.ret = ret;

	/* 自モジュールメッセージ送信 */
	FRM_MsgSendAsync(EOTA_SPORT, sizeof(Mssage), &Mssage);

	DEBUG_TRCOUT();
}

/*--------------------------------------------------------------------------*/
/* 自モジュール⇒他モジュール												*/
/*--------------------------------------------------------------------------*/
/*==========================================================================*/
/*	Description		:	ダウンロード遷移条件送信(スマホへ)					*/
/*--------------------------------------------------------------------------*/
/*	param			:	ダウンロード遷移条件								*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	ダウンロード遷移条件を送信する						*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_SetDownLoadState(
	EOTA_DOWN_LOAD_STATE_T DownLoadState)		/* [i] ダウンロード遷移条件	*/
{
	DEBUG_TRCIN();

	/* TODO. */

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	スマホ用情報送信(スマホへ)							*/
/*--------------------------------------------------------------------------*/
/*	param			:	スマホ用情報										*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	FW更新スマホ用情報を送信する						*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_SetUpdInfoPhone(
		EOTA_PHONE_UPD_INFO_T * UpdInfo)		/* [i] FW更新スマホ用情報	*/
{
	DEBUG_TRCIN();

	/* TODO. */

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	進捗率送信(スマホへ)								*/
/*--------------------------------------------------------------------------*/
/*	param			:	進捗率												*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	進捗率を送信する									*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_SetProgressRate(uchar ProgressRate)				/* [i] 進捗率	*/
{
	DEBUG_TRCIN();

	/* TODO. */

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	更新状態送信(スマホへ)								*/
/*--------------------------------------------------------------------------*/
/*	param			:	更新状態											*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	更新遷移条件を送信する								*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_SetUpdState(EOTA_UPDATE_STATE_T UpdState)		/* [i] 更新状態		*/
{
	DEBUG_TRCIN();

	/* TODO. */

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	見守りサーバ用情報送信(見守りサーバへ)				*/
/*--------------------------------------------------------------------------*/
/*	param			:	見守りサーバ用情報									*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	FW更新見守りサーバ用情報を送信する					*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_SetUpdInfoSub(
		EOTA_SUB_UPD_INFO_T * UpdInfo)		/* [i] FW更新見守りサーバ用情報	*/
{
	DEBUG_TRCIN();

	/* TODO. */

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	CMD65:運転/停止=停止(INVへ)							*/
/*--------------------------------------------------------------------------*/
/*	param			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	CMD65:運転/停止=停止を送信する						*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_SendCMD65Stop()
{
	DEBUG_TRCIN();

	/* TODO. */
	/*EINV_ReqOpeMode();*/

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	CMD81 の定期送信停止(INVへ)							*/
/*--------------------------------------------------------------------------*/
/*	param			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	CMD81 の定期送信を停止する							*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_SendCMD81Stop()
{
	DEBUG_TRCIN();

	/* TODO. */

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	CMD11 送信(転送 FW 問い合わせ)(INVへ)				*/
/*--------------------------------------------------------------------------*/
/*	param			:	送信メッセージ										*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	CMD11 のデータを送信する							*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_SendInvCMD11(
			EOTA_CMD11_REQ_INFO_T * Message)		/* [i] 送信メッセージ	*/
{
	DEBUG_TRCIN();

	/* TODO. */
	/* INV送信共通関数 */

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	CMD60 送信(INVへ)									*/
/*--------------------------------------------------------------------------*/
/*	param			:	送信メッセージ										*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	CMD11 のデータを送信する							*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_SendInvCMD60( )		/* [i] 送信メッセージ TODO	*/
{
	DEBUG_TRCIN();

	/* TODO. */
	/* INV送信共通関数 */

	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:	LED動作(LED側へ)									*/
/*--------------------------------------------------------------------------*/
/*	param			:	送信メッセージ										*/
/*--------------------------------------------------------------------------*/
/*	return			:	無し												*/
/*--------------------------------------------------------------------------*/
/*	detail			:	CMD11 のデータを送信する							*/
/*--------------------------------------------------------------------------*/
/*	history 		:	2023/03/20 : DHC.zhangs : 新規作成					*/
/*==========================================================================*/
void EOTA_Set_Led(
			EOTA_LED_UPD_INFO_T Led)		/* [i] LED動作状態	*/
{
	DEBUG_TRCIN();

	/* TODO. */
	/* LED動作(LED側へ) */

	DEBUG_TRCOUT();
}

/*--------------------------------------------------------------------------*/
/* 非公開関数定義															*/
/*--------------------------------------------------------------------------*/

