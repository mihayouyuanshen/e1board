/****************************************************************************/
/*	Description		:LED制御プロセス ファイル制御							*/
/*--------------------------------------------------------------------------*/
/*	Author			:DHC Gu.CM												*/
/*--------------------------------------------------------------------------*/
/*	Date			:2023/03/13												*/
/*--------------------------------------------------------------------------*/
/*	Module Name		:														*/
/*--------------------------------------------------------------------------*/
/*	Note			:														*/
/*--------------------------------------------------------------------------*/
/*	Copyright		:(c) 2020 NICHICON CORPORATION							*/
/****************************************************************************/

/*--------------------------------------------------------------------------*/
/*	Include Header File														*/
/*--------------------------------------------------------------------------*/
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include "common_g.h"
#include "frm_g.h"
#include "task_g.h"
#include "eled_file_g.h"
#include "dlog_g.h"

/*--------------------------------------------------------------------------*/
/*	公開変数定義															*/
/*--------------------------------------------------------------------------*/


/*--------------------------------------------------------------------------*/
/*	非公開変数定義															*/
/*--------------------------------------------------------------------------*/
#define ELED_OP_FILE_ERR	((sshort)-1)
#define ELED_OP_FILE_SUCC	((sshort)0)
#define ELED_DATA_COUNT		((ulong)1u)

/*--------------------------------------------------------------------------*/
/*	公開関数定義															*/
/*--------------------------------------------------------------------------*/
/*==========================================================================*/
/*	Description		:保存ファイルからお知らせ読出し							*/
/*--------------------------------------------------------------------------*/
/*	param			:pPath	ファイルPATH									*/
/*					:p_buf	格納先バッファ									*/
/*					:size    読込みサイズ									*/
/*--------------------------------------------------------------------------*/
/*	return			:rtcd	リターンコード									*/
/*					(0:正常終了/-1:異常終了)								*/
/*--------------------------------------------------------------------------*/
/*	detail			:														*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/13 : DHC Gu.CM : 新規作成						*/
/*==========================================================================*/
sshort ELED_FileRead(schar *pPath, schar *pBuf, ushort size)
{
	sshort rtcd;
	FILE *fp;
	size_t rtnRead;

	DEBUG_TRCIN();

	rtcd = ELED_OP_FILE_ERR;

	fp = CMN_FOPEN(pPath, "rb");
	if (fp != NULL)
	{
		rtnRead = fread(pBuf, size, (size_t)ELED_DATA_COUNT, fp);
		if (rtnRead == (size_t)ELED_DATA_COUNT)
		{
			rtcd = ELED_OP_FILE_SUCC;
		}
		CMN_FCLOSE(fp);
	}

	DEBUG_TRCOUT();

	return	rtcd;
}
/*==========================================================================*/
/*	Description		:保存ファイルへのお知らせ書込み							*/
/*--------------------------------------------------------------------------*/
/*	param			:pPath	ファイルPAT										*/
/*					:pBuf	読出先バッファ									*/
/*                   :size	書込みサイズ									*/
/*--------------------------------------------------------------------------*/
/*	return			:rtcd	リターンコード									*/
/*					(0:正常終了/-1:異常終了)								*/
/*--------------------------------------------------------------------------*/
/*	detail			:														*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/13 : DHC Gu.CM : 新規作成						*/
/*==========================================================================*/
sshort ELED_FileWrite(schar *pPath, schar *pBuf, ushort size)
{
	sshort rtcd;
	FILE *fp;
	size_t rtnWrite;
	sint fd;

	DEBUG_TRCIN();

	rtcd = ELED_OP_FILE_ERR;

	fp = CMN_FOPEN(pPath, "wb");
	if (fp != NULL)
	{
		fd = fileno(fp);

		rtnWrite = fwrite((schar *)pBuf, size, (size_t)ELED_DATA_COUNT, fp);
		if (rtnWrite == (size_t)ELED_DATA_COUNT)
		{
			rtcd = ELED_OP_FILE_SUCC;
		}
		/* ファイル書込み後、sync実行する */
#if 0
		fsync(fd);
#endif
		fflush(fp);
		fdatasync(fd);
		CMN_FCLOSE(fp);
	}

	DEBUG_TRCOUT();

	return	rtcd;
}

/*--------------------------------------------------------------------------*/
/*	非公開関数定義															*/
/*--------------------------------------------------------------------------*/

/*End Of File*/
