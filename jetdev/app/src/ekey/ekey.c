/****************************************************************************/
/*	Description		:キー入力制御プロセス									*/
/*--------------------------------------------------------------------------*/
/*	Author			:DHC Cao.HZ												*/
/*--------------------------------------------------------------------------*/
/*	Date			:2023/03/16												*/
/*--------------------------------------------------------------------------*/
/*	Module Name		:EKEY													*/
/*--------------------------------------------------------------------------*/
/*	Note			:														*/
/*--------------------------------------------------------------------------*/
/*	Copyright		:(c) 2020 NICHICON CORPORATION							*/
/****************************************************************************/

/*--------------------------------------------------------------------------*/
/*	Include header File														*/
/*--------------------------------------------------------------------------*/
#include <stdio.h>
#include "frm_g.h"
#include "task_g.h"
#include "typedef.h"
#include "dlog_g.h"
#include "ekey_cmn_g.h"
#include "ekey_serv_g.h"
#include "esys_g.h"
/*--------------------------------------------------------------------------*/
/*	公開変数定義															*/
/*--------------------------------------------------------------------------*/
extern bool_t g_ekeyPollFlg;
/*--------------------------------------------------------------------------*/
/*	公開関数定義															*/
/*--------------------------------------------------------------------------*/
/*==========================================================================*/
/*	Description		:キー入力制御初期化										*/
/*--------------------------------------------------------------------------*/
/*	param			:void													*/
/*--------------------------------------------------------------------------*/
/*	return			:void													*/
/*--------------------------------------------------------------------------*/
/*	detail			:キー入力制御初期化										*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/16 : DHC Cao.HZ : 新規作成						*/
/*==========================================================================*/
void EKEY_Init(void)
{
	DEBUG_TRCIN();
	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:キー入力制御メッセージプロセス処理						*/
/*--------------------------------------------------------------------------*/
/*	param			:FrmMsgHead_t *msg										*/
/*--------------------------------------------------------------------------*/
/*	return			:void													*/
/*--------------------------------------------------------------------------*/
/*	detail			:キー入力制御メッセージプロセス処理						*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/16 : DHC Cao.HZ : 新規作成						*/
/*==========================================================================*/
void EKEY_MsgProc(FrmMsgHead_t const *msg)
{
	DEBUG_TRCIN();
	switch(msg->attr) {
	case FRM_MSG_ASYNC:
		/* header.functionIDで各処理に分岐 */
		switch(msg->msgId){
		case EKEY_MSGID_START:
			EKEY_CreateSubThread();
			ESYS_NotifyStartResult(EKEY_SPORT, MOD_ACTION_RESULT_SUCCESS);
			break;
		case EKEY_MSGID_KEY_ONOFF:
			EKEY_ProcKeyOnOff(msg);
			break;
		case EKEY_MSGID_KEY_CANCEL:
			EKEY_ProcKeyCancel(msg);
			break;
		case EKEY_MSGID_STOP:
		{
			EKEY_Stop_t const* stopMsg = (EKEY_Stop_t const*)msg;
			FRM_PthreadCancel(stopMsg->tid);
			break;
		}
		default:
			break;
		}
		break;
	case FRM_MSG_EVENT:
		switch(msg->msgId){
		case LFW_MSGID_TIMER_TIMEOUT:
			EKEY_ProcKeyTimeout(msg);
			break;
		case LFW_MSGID_WDT_REQ:
			/* Watch Dog */
			break;
		default:
			break;
		}
		break;
	default:
		break;
	}
	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:キー入力制御終了										*/
/*--------------------------------------------------------------------------*/
/*	param			:void													*/
/*--------------------------------------------------------------------------*/
/*	return			:void													*/
/*--------------------------------------------------------------------------*/
/*	detail			:キー入力制御終了										*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/16 : DHC Cao.HZ : 新規作成						*/
/*==========================================================================*/
void EKEY_Fin(void)
{
	DEBUG_TRCIN();
	DEBUG_TRCOUT();
}

/*==========================================================================*/
/*	Description		:キー入力制御開始										*/
/*--------------------------------------------------------------------------*/
/*	param			:slong fact												*/
/*--------------------------------------------------------------------------*/
/*	return			:slong													*/
/*--------------------------------------------------------------------------*/
/*	detail			:キー入力制御開始										*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/16 : DHC Cao.HZ : 新規作成						*/
/*==========================================================================*/
slong EKEY_Start(slong fact)
{
	EKEY_Start_t msg;

	DEBUG_TRCIN();
	msg.header.msgId = EKEY_MSGID_START;
	msg.fact = fact;
	FRM_MsgSendAsync(EKEY_SPORT, sizeof(msg), &msg);

	DEBUG_TRCOUT();
	return 0;
}

/*==========================================================================*/
/*	Description		:キー入力制御終了										*/
/*--------------------------------------------------------------------------*/
/*	param			:void													*/
/*--------------------------------------------------------------------------*/
/*	return			:slong													*/
/*--------------------------------------------------------------------------*/
/*	detail			:キー入力制御終了										*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/03/16 : DHC Cao.HZ : 新規作成						*/
/*==========================================================================*/
slong EKEY_Stop(void)
{
	DEBUG_TRCIN();
	g_ekeyPollFlg = FALSE;
	ESYS_NotifyStopResult(EKEY_SPORT, MOD_ACTION_RESULT_SUCCESS);
	DEBUG_TRCOUT();
	return 0;
}
/*==========================================================================*/
/*	Description		:中断ボタン処理											*/
/*--------------------------------------------------------------------------*/
/*	param			:EKEY_Btn_t ボタンID									*/
/*--------------------------------------------------------------------------*/
/*	return			:void													*/
/*--------------------------------------------------------------------------*/
/*	detail			:中断ボタン処理											*/
/*--------------------------------------------------------------------------*/
/*	history			:2023/04/24 : DHC Cao.HZ : 新規作成						*/
/*==========================================================================*/
void EKEY_BtnCancel(EKEY_Btn_t btn)
{
	EKEY_KeyCancel_t keyCancelMsg;

	DEBUG_TRCIN();
	keyCancelMsg.header.msgId = EKEY_MSGID_KEY_CANCEL;
	keyCancelMsg.btn = btn;

	FRM_MsgSendAsync(EKEY_SPORT, sizeof(keyCancelMsg), &keyCancelMsg);
	DEBUG_TRCOUT();
}

/*End Of File*/
